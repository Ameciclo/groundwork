# Install NGINX Ingress Controller using Helm
# helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
# helm repo update
# helm install ingress-nginx ingress-nginx/ingress-nginx --namespace ingress-nginx --create-namespace

---
# Ingress for Kong Admin
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kong-admin-ingress
  namespace: ameciclo
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  tls:
  - hosts:
    - kong-admin.example.com
    secretName: kong-admin-tls
  rules:
  - host: kong-admin.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: kong-admin
            port:
              number: 8001

---
# Ingress for Kestra
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: kestra-ingress
  namespace: ameciclo
  annotations:
    kubernetes.io/ingress.class: nginx
    cert-manager.io/cluster-issuer: letsencrypt-prod
spec:
  tls:
  - hosts:
    - kestra.example.com
    secretName: kestra-tls
  rules:
  - host: kestra.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: kestra
            port:
              number: 8080

---
# Ingress for Cyclist Profile API
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cyclist-profile-ingress
  namespace: ameciclo
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  rules:
  - host: api.example.com
    http:
      paths:
      - path: /cyclist-profile
        pathType: Prefix
        backend:
          service:
            name: cyclist-profile
            port:
              number: 3000

---
# Ingress for Cyclist Counts API
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: cyclist-counts-ingress
  namespace: ameciclo
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  rules:
  - host: api.example.com
    http:
      paths:
      - path: /cyclist-counts
        pathType: Prefix
        backend:
          service:
            name: cyclist-counts
            port:
              number: 3002

---
# Ingress for Traffic Deaths API
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: traffic-deaths-ingress
  namespace: ameciclo
  annotations:
    kubernetes.io/ingress.class: nginx
spec:
  rules:
  - host: api.example.com
    http:
      paths:
      - path: /traffic-deaths
        pathType: Prefix
        backend:
          service:
            name: traffic-deaths
            port:
              number: 3003

