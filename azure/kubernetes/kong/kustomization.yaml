# Kustomization for Kong Helm Chart
# This file allows ArgoCD to manage Kong deployments
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

namespace: kong

# Use Helm to render the Kong chart
helmCharts:
  - name: kong
    repo: https://charts.konghq.com
    version: 2.36.3
    releaseName: kong
    namespace: kong
    valuesFile: values.yaml

# Create ConfigMap with Azure CA certificates
configMapGenerator:
  - name: azure-ca-certs
    files:
      - ca-certificates.crt

# Patch the Kong deployment to mount CA certificates
patchesStrategicMerge:
  - deployment-patch.yaml
