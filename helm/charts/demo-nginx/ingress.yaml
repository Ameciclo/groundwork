apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
  name: demo-nginx
  namespace: demo
spec:
  entryPoints:
    - web
    - websecure
  routes:
    # ACME challenge route (highest priority)
    - match: Host(`azure.teste.ameciclo.org`) && PathPrefix(`/.well-known/acme-challenge`)
      kind: Rule
      priority: 1000
      services:
        - name: noop@internal
          kind: TraefikService
    # Main application route
    - match: Host(`azure.teste.ameciclo.org`)
      kind: Rule
      priority: 100
      services:
        - name: demo-nginx
          port: 80
  tls:
    certResolver: letsencrypt
    domains:
      - main: azure.teste.ameciclo.org
