# Traefik Configuration for K3s
# This configures the native Traefik instance that comes with K3s
# K3s automatically deploys Traefik in kube-system namespace
#
# Note: K3s installs Traefik by default. This manifest patches/configures it.
# The actual Traefik deployment is managed by K3s, we just configure it.

apiVersion: v1
kind: ConfigMap
metadata:
  name: traefik-config
  namespace: kube-system
data:
  traefik.yaml: |
    # Traefik Configuration
    global:
      checkNewVersion: false
      sendAnonymousUsage: false

    # Entry Points
    entryPoints:
      web:
        address: ":8000"
      websecure:
        address: ":8443"
      traefik:
        address: ":8080"
      metrics:
        address: ":9100"

    # API and Dashboard
    api:
      dashboard: true
      debug: false
      insecure: false

    # Providers
    providers:
      kubernetescrd:
        endpoint: ""
        ingressClass: traefik
        allowCrossNamespace: false
        allowExternalNameServices: false
      kubernetesingress:
        endpoint: ""
        ingressClass: traefik
        allowCrossNamespace: false
        allowExternalNameServices: false

    # Metrics
    metrics:
      prometheus:
        addEntryPointsLabels: true
        addServicesLabels: true
        entryPoint: metrics

    # Logging
    log:
      level: INFO
      format: json

    # Access Log
    accessLog:
      format: json
