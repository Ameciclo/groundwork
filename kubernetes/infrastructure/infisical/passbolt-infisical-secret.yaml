---
# Infisical Secret for Passbolt
# Syncs secrets from Infisical to Kubernetes for Passbolt password manager
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: passbolt-infisical-secret
  namespace: passbolt
  labels:
    app.kubernetes.io/name: passbolt
    app.kubernetes.io/component: secrets
spec:
  # Reference to the Infisical authentication method
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: groundwork
        envSlug: prod
        secretsPath: /passbolt
      credentialsRef:
        secretName: infisical-machine-identity
        secretNamespace: infisical

  # Target Kubernetes secret configuration
  managedSecretReference:
    secretName: passbolt-infisical-managed
    secretNamespace: passbolt
    secretType: Opaque
    creationPolicy: Owner

  # Sync interval
  resyncInterval: 60

# =============================================================
# REQUIRED SECRETS IN INFISICAL (path: /passbolt)
# =============================================================
# Database:
#   - DATASOURCES_DEFAULT_HOST (e.g., ameciclo-postgres.postgres.database.azure.com)
#   - DATASOURCES_DEFAULT_PORT (e.g., 5432)
#   - DATASOURCES_DEFAULT_DATABASE (e.g., passbolt)
#   - DATASOURCES_DEFAULT_USERNAME
#   - DATASOURCES_DEFAULT_PASSWORD
#
# Redis:
#   - CACHE_CAKECORE_PASSWORD
#   - CACHE_CAKEMODEL_PASSWORD
#   - CACHE_DEFAULT_PASSWORD
#
# Email (optional):
#   - EMAIL_TRANSPORT_DEFAULT_USERNAME
#   - EMAIL_TRANSPORT_DEFAULT_PASSWORD
#
# GPG (will be auto-generated if not provided):
#   - PASSBOLT_GPG_SERVER_KEY_FINGERPRINT
# =============================================================

