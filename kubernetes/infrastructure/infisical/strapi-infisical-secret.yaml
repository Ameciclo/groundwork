---
# InfisicalSecret CRD to sync secrets from Infisical to Kubernetes
# Uses Universal Auth with credentials from central infisical-system namespace
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: strapi-secrets
  namespace: strapi
  labels:
    app.kubernetes.io/name: strapi
    app.kubernetes.io/part-of: strapi
    app.kubernetes.io/component: secrets
spec:
  # Infisical API endpoint
  hostAPI: https://app.infisical.com/api

  # Universal Auth authentication
  # Credentials stored in central infisical-system namespace
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: strapi-he-ce
        envSlug: prod
        secretsPath: "/"
      credentialsRef:
        secretName: infisical-universal-auth
        secretNamespace: infisical-system  # Central namespace for all apps

  # Target Kubernetes secret
  managedSecretReference:
    secretName: strapi-infisical-managed
    secretNamespace: strapi
    creationPolicy: Owner

  # Sync interval in seconds
  resyncInterval: 60
