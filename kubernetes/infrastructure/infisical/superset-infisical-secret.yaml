---
# InfisicalSecret CRD to sync Superset secrets from Infisical to Kubernetes
# Uses Universal Auth with credentials from central infisical-system namespace
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: superset-secrets
  namespace: superset
  labels:
    app.kubernetes.io/name: superset
    app.kubernetes.io/part-of: superset
    app.kubernetes.io/component: secrets
spec:
  # Infisical API endpoint
  hostAPI: https://app.infisical.com/api

  # Universal Auth authentication
  # Credentials stored in central infisical-system namespace
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: superset  # TODO: Update with actual Infisical project slug
        envSlug: prod
        secretsPath: "/"
      credentialsRef:
        secretName: infisical-universal-auth
        secretNamespace: infisical-system  # Central namespace for all apps

  # Target Kubernetes secret
  managedSecretReference:
    secretName: superset-infisical-managed
    secretNamespace: superset
    creationPolicy: Owner

  # Sync interval in seconds
  resyncInterval: 60

# =============================================================
# REQUIRED SECRETS IN INFISICAL
# =============================================================
# Create these secrets in your Infisical project (superset):
#
# DATABASE_HOST     - Azure PostgreSQL hostname
#                     e.g., ameciclo-postgres.postgres.database.azure.com
#
# DATABASE_NAME     - Database name for Superset
#                     e.g., superset
#
# DATABASE_USER     - Database username
#                     e.g., superset@ameciclo-postgres
#
# DATABASE_PASSWORD - Database password
#
# SECRET_KEY        - Flask secret key for session signing
#                     Generate with: openssl rand -base64 42
#
# MAPBOX_API_KEY    - (Optional) Mapbox API key for map visualizations
#                     Get from: https://account.mapbox.com/access-tokens/

