---
# InfisicalSecret CRD to sync Zitadel secrets from Infisical to Kubernetes
# Uses Universal Auth with credentials from central infisical-system namespace
apiVersion: secrets.infisical.com/v1alpha1
kind: InfisicalSecret
metadata:
  name: zitadel-secrets
  namespace: zitadel
  labels:
    app.kubernetes.io/name: zitadel
    app.kubernetes.io/part-of: zitadel
    app.kubernetes.io/component: secrets
spec:
  # Infisical API endpoint
  hostAPI: https://app.infisical.com/api

  # Universal Auth authentication
  # Credentials stored in central infisical-system namespace
  authentication:
    universalAuth:
      secretsScope:
        projectSlug: groundwork-z2e9
        envSlug: prod
        secretsPath: "/"
      credentialsRef:
        secretName: infisical-universal-auth
        secretNamespace: infisical-system  # Central namespace for all apps

  # Target Kubernetes secret
  managedSecretReference:
    secretName: zitadel-infisical-managed
    secretNamespace: zitadel
    creationPolicy: Owner

  # Sync interval in seconds
  resyncInterval: 60

# =============================================================
# REQUIRED SECRETS IN INFISICAL (groundwork-z2e9 / production)
# =============================================================
# ZITADEL_MASTERKEY                          - 32-byte master key for encryption
#                                              Generate with: openssl rand -base64 32
# ZITADEL_DATABASE_POSTGRES_USER_USERNAME    - Database username
# ZITADEL_DATABASE_POSTGRES_USER_PASSWORD    - Database password

